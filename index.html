<!DOCTYPE html>
<html lang="gu">
<head>
  <meta charset="UTF-8">
  <title>ફ્રિજ ક્રેટ્સ ડેટા</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    h2 { color: #333; }
    label { display: block; margin-top: 10px; }
    input, select, button {
      margin-top: 5px;
      padding: 8px;
      width: 100%;
      max-width: 300px;
    }
    .status {
      margin-top: 15px;
      font-weight: bold;
    }
    .success { color: green; }
    .error { color: red; }
  </style>
</head>
<body>
  <h2>ફ્રિજ ક્રેટ્સ ડેટા</h2>
  <label>તારીખ:</label>
  <input type="date" id="dateInput">

  <label>ટોટલ ક્રેટ્સ:</label>
  <input type="number" id="totalCrates" placeholder="ટોટલ ક્રેટ્સ">

  <label>વેચાયેલ ક્રેટ્સ:</label>
  <input type="number" id="soldCrates" placeholder="વેચાયેલ ક્રેટ્સ">

  <button onclick="saveData()">સેવ કરો</button>

  <div id="status" class="status"></div>

  <script type="module">
    // Import Firebase SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // ✅ સાચું Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyAvmNdKnVDqciXWN-fASQ77b9ovdamaM7k",
      authDomain: "amul-stock.firebaseapp.com",
      projectId: "amul-stock",
      storageBucket: "amul-stock.appspot.com",
      messagingSenderId: "721564107787",
      appId: "1:721564107787:web:d2e305a47e0a8becae730e"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const statusEl = document.getElementById("status");

    // 🔹 Save data to Firestore
    async function saveData() {
      const date = document.getElementById("dateInput").value;
      const total = document.getElementById("totalCrates").value;
      const sold = document.getElementById("soldCrates").value;

      if (!date) {
        statusEl.textContent = "કૃપા કરીને તારીખ નાખો!";
        statusEl.className = "status error";
        return;
      }

      try {
        await setDoc(doc(db, "fridge_crates", date), {
          totalCrates: Number(total),
          soldCrates: Number(sold),
          updatedAt: new Date().toISOString()
        });

        statusEl.textContent = "ડેટા સફળતાપૂર્વક સેવ થયો ✅";
        statusEl.className = "status success";
      } catch (e) {
        console.error("Save error:", e);
        statusEl.textContent = "એરર: " + e.message;
        statusEl.className = "status error";
      }
    }

    // 🔹 Load data if exists
    async function loadData() {
      const today = new Date().toISOString().split("T")[0];
      document.getElementById("dateInput").value = today;

      try {
        const docRef = doc(db, "fridge_crates", today);
        const snap = await getDoc(docRef);

        if (snap.exists()) {
          const data = snap.data();
          document.getElementById("totalCrates").value = data.totalCrates || "";
          document.getElementById("soldCrates").value = data.soldCrates || "";
          statusEl.textContent = "રિયલ ટાઈમ જોડાયેલ √";
          statusEl.className = "status success";
        } else {
          statusEl.textContent = "કોઈ ડેટા મળ્યો નથી.";
          statusEl.className = "status error";
        }
      } catch (e) {
        console.error("Load error:", e);
        statusEl.textContent = "એરર: " + e.message;
        statusEl.className = "status error";
      }
    }

    // Auto-load data on page load
    loadData();
  </script>
</body>
</html>
