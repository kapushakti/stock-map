<!DOCTYPE html>
<html lang="gu">
<head>
  <meta charset="UTF-8">
  <title>àª«à«àª°àª¿àªœ àª•à«àª°à«‡àªŸà«àª¸ àª¡à«‡àªŸàª¾</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    h2 { color: #333; }
    label { display: block; margin-top: 10px; }
    input, select, button {
      margin-top: 5px;
      padding: 8px;
      width: 100%;
      max-width: 300px;
    }
    .status {
      margin-top: 15px;
      font-weight: bold;
    }
    .success { color: green; }
    .error { color: red; }
  </style>
</head>
<body>
  <h2>àª«à«àª°àª¿àªœ àª•à«àª°à«‡àªŸà«àª¸ àª¡à«‡àªŸàª¾</h2>
  <label>àª¤àª¾àª°à«€àª–:</label>
  <input type="date" id="dateInput">

  <label>àªŸà«‹àªŸàª² àª•à«àª°à«‡àªŸà«àª¸:</label>
  <input type="number" id="totalCrates" placeholder="àªŸà«‹àªŸàª² àª•à«àª°à«‡àªŸà«àª¸">

  <label>àªµà«‡àªšàª¾àª¯à«‡àª² àª•à«àª°à«‡àªŸà«àª¸:</label>
  <input type="number" id="soldCrates" placeholder="àªµà«‡àªšàª¾àª¯à«‡àª² àª•à«àª°à«‡àªŸà«àª¸">

  <button onclick="saveData()">àª¸à«‡àªµ àª•àª°à«‹</button>

  <div id="status" class="status"></div>

  <script type="module">
    // Import Firebase SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // âœ… àª¸àª¾àªšà«àª‚ Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyAvmNdKnVDqciXWN-fASQ77b9ovdamaM7k",
      authDomain: "amul-stock.firebaseapp.com",
      projectId: "amul-stock",
      storageBucket: "amul-stock.appspot.com",
      messagingSenderId: "721564107787",
      appId: "1:721564107787:web:d2e305a47e0a8becae730e"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const statusEl = document.getElementById("status");

    // ğŸ”¹ Save data to Firestore
    async function saveData() {
      const date = document.getElementById("dateInput").value;
      const total = document.getElementById("totalCrates").value;
      const sold = document.getElementById("soldCrates").value;

      if (!date) {
        statusEl.textContent = "àª•à«ƒàªªàª¾ àª•àª°à«€àª¨à«‡ àª¤àª¾àª°à«€àª– àª¨àª¾àª–à«‹!";
        statusEl.className = "status error";
        return;
      }

      try {
        await setDoc(doc(db, "fridge_crates", date), {
          totalCrates: Number(total),
          soldCrates: Number(sold),
          updatedAt: new Date().toISOString()
        });

        statusEl.textContent = "àª¡à«‡àªŸàª¾ àª¸àª«àª³àª¤àª¾àªªà«‚àª°à«àªµàª• àª¸à«‡àªµ àª¥àª¯à«‹ âœ…";
        statusEl.className = "status success";
      } catch (e) {
        console.error("Save error:", e);
        statusEl.textContent = "àªàª°àª°: " + e.message;
        statusEl.className = "status error";
      }
    }

    // ğŸ”¹ Load data if exists
    async function loadData() {
      const today = new Date().toISOString().split("T")[0];
      document.getElementById("dateInput").value = today;

      try {
        const docRef = doc(db, "fridge_crates", today);
        const snap = await getDoc(docRef);

        if (snap.exists()) {
          const data = snap.data();
          document.getElementById("totalCrates").value = data.totalCrates || "";
          document.getElementById("soldCrates").value = data.soldCrates || "";
          statusEl.textContent = "àª°àª¿àª¯àª² àªŸàª¾àªˆàª® àªœà«‹àª¡àª¾àª¯à«‡àª² âˆš";
          statusEl.className = "status success";
        } else {
          statusEl.textContent = "àª•à«‹àªˆ àª¡à«‡àªŸàª¾ àª®àª³à«àª¯à«‹ àª¨àª¥à«€.";
          statusEl.className = "status error";
        }
      } catch (e) {
        console.error("Load error:", e);
        statusEl.textContent = "àªàª°àª°: " + e.message;
        statusEl.className = "status error";
      }
    }

    // Auto-load data on page load
    loadData();
  </script>
</body>
</html>
